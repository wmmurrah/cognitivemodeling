%% Twenty Questions

clear;

sampler = 0; % Choose 0=WinBUGS, 1=JAGS

%% Data
dataset = 1; % Choose The Dataset
switch dataset
    case 1, k = [1 1 1 1 0 0 1 1 0 1 0 0 1 0 0 1 0 1 0 0;
            0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
            0 0 1 0 0 0 1 1 0 0 0 0 1 0 0 0 0 0 0 0;
            0 0 0 0 0 0 1 0 1 1 0 0 0 0 0 0 0 0 0 0;
            1 0 1 1 0 1 1 1 0 1 0 0 1 0 0 0 0 1 0 0;
            1 1 0 1 0 0 0 1 0 1 0 1 1 0 0 1 0 1 0 0;
            0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0;
            0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
            0 1 1 0 0 0 0 1 0 1 0 0 1 0 0 0 0 1 0 1;
            1 0 0 0 0 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0];
    case 2, k = [1 1 1 1 0 0 1 1 0 1 0 0 nan 0 0 1 0 1 0 0;
            0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
            0 0 1 0 0 0 1 1 0 0 0 0 1 0 0 0 0 0 0 0;
            0 0 0 0 0 0 1 0 1 1 0 0 0 0 0 0 0 0 0 0;
            1 0 1 1 0 1 1 1 0 1 0 0 1 0 0 0 0 1 0 0;
            1 1 0 1 0 0 0 1 0 1 0 1 1 0 0 1 0 1 0 0;
            0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0;
            0 0 0 0 nan 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
            0 1 1 0 0 0 0 1 0 1 0 0 1 0 0 0 0 1 0 1;
            1 0 0 0 0 0 1 0 0 1 0 0 1 0 0 0 0 nan 0 0];
end;

% Constants
[np,nq] = size(k); % Number of people and questions

%% Sampling
% MCMC Parameters
nchains = 2; % How Many Chains?
nburnin = 1e3; % How Many Burn-in Samples?
nsamples = 1e4;  %How Many Recorded Samples?
nthin = 1; % How Often is a Sample Recorded?
doparallel = 0; % Parallel Option

% Assign Matlab Variables to the Observed Nodes
datastruct = struct('np',np,'nq',nq,'k',k);

% Initial Values to Supply to WinBugs
for i=1:nchains
    S.p = rand(1,np);
    S.q = rand(1,nq);
    init0(i) = S;
end

% Sample
switch dataset
    case 1,
        if ~sampler
            % Use WinBUGS to Sample
            tic
            [samples, stats] = matbugs(datastruct, ...
                fullfile(pwd, 'TwentyQuestions.txt'), ...
                'init', init0, ...
                'nChains', nchains, ...
                'view', 1, 'nburnin', nburnin, 'nsamples', nsamples, ...
                'thin', nthin, 'DICstatus', 0, 'refreshrate',100, ...
                'monitorParams', {'p','q'}, ...
                'Bugdir', 'C:/Program Files/WinBUGS14');
            toc
        else
            % Use JAGS to Sample
            tic
            fprintf( 'Running JAGS ...\n' );
            [samples, stats] = matjags( ...
                datastruct, ...
                fullfile(pwd, 'TwentyQuestions.txt'), ...
                init0, ...
                'doparallel' , doparallel, ...
                'nchains', nchains,...
                'nburnin', nburnin,...
                'nsamples', nsamples, ...
                'thin', nthin, ...
                'monitorparams', {'p','q'}, ...
                'savejagsoutput' , 1 , ...
                'verbosity' , 1 , ...
                'cleanup' , 0 , ...
                'workingdir' , 'tmpjags' );
            toc
        end;
    case 2,
        if ~sampler
            % Use WinBUGS to Sample
            tic
            [samples, stats] = matbugs(datastruct, ...
                fullfile(pwd, 'TwentyQuestions.txt'), ...
                'init', init0, ...
                'nChains', nchains, ...
                'view', 1, 'nburnin', nburnin, 'nsamples', nsamples, ...
                'thin', nthin, 'DICstatus', 0, 'refreshrate',100, ...
                'monitorParams', {'p','q','k'}, ...
                'Bugdir', 'C:/Program Files/WinBUGS14');
            toc
        else
            % Use JAGS to Sample
            tic
            fprintf( 'Running JAGS...\n' );
            [samples, stats] = matjags( ...
                datastruct, ...
                fullfile(pwd, 'TwentyQuestions.txt'), ...
                init0, ...
                'doparallel' , doparallel, ...
                'nchains', nchains,...
                'nburnin', nburnin,...
                'nsamples', nsamples, ...
                'thin', nthin, ...
                'monitorparams', {'p','q','k'}, ...
                'savejagsoutput' , 1 , ...
                'verbosity' , 1 , ...
                'cleanup' , 0 , ...
                'workingdir' , 'tmpjags' );
            toc
        end;
end;



